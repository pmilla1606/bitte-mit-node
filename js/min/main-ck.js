var dummyData=[{track_id:1,track_name:"Track name 1",track_artist:"Track artist 1",track_uri:"track uri goes here",party_name:"party name here",is_current:1,has_changed:0,playlist_uri:"playlist uri here",position:1},{track_id:2,track_name:"Track name 2",track_artist:"Track artist 2",track_uri:"track uri goes here",party_name:"party name here",is_current:0,has_changed:0,playlist_uri:"playlist uri here",position:2},{track_id:3,track_name:"Track name 3",track_artist:"Track artist 3",track_uri:"track uri goes here",party_name:"party name here",is_current:0,has_changed:0,playlist_uri:"playlist uri here",position:3},{track_id:4,track_name:"Track name 4",track_artist:"Track artist 4",track_uri:"track uri goes here",party_name:"party name here",is_current:0,has_changed:0,playlist_uri:"playlist uri here",position:4}],TrackModel=Backbone.Model.extend({defaults:{track_id:0,track_name:"blank name",track_artist:"blank artist",track_uri:"blank uri",party_name:"blank party name",is_current:0,has_changed:0,playlist_uri:"blank playlist uri",position:0,added_by:"Jean Claude Van Damme"}}),TrackCollection=Backbone.Collection.extend({model:TrackModel,initialize:function(){this.reset()},comparator:function(e){return e.get("position")}}),currentDeck=new TrackCollection(dummyData),AppView=Backbone.View.extend({initialize:function(){var e=this,t=3;localStorage.getItem("userVotes")||localStorage.setItem("userVotes",3),e.render()},render:function(){var e=new LoginView}}),LoginView=Backbone.View.extend({el:"section#login",events:{"click #loginSubmit":"login"},initialize:function(){localStorage.getItem("userName")&&this.renderTracks()},login:function(){var e=this.$el.find("#username");""===!e?localStorage.setItem("userName",e.val()):localStorage.setItem("userName","Anon"+Date.now()),this.renderTracks()},renderTracks:function(){var e=new TrackListView;this.$el.removeClass("active"),$("body").find("section#tracks").addClass("active")}}),TrackListView=Backbone.View.extend({el:".tracksWrapper",events:{},initialize:function(){localStorage.getItem("userVotes")<=0?this.outOfVotes():(this.render(),currentDeck.on("change:position",this.render,this))},render:function(){var e=this;currentDeck.sort(),this.$el.html(""),currentDeck.forEach(function(t){if(1==t.get("is_current")){t.set({position:999});var a=new CurrentTrackView({model:t});e.$el.prepend(a.render())}else{var i=new TrackView({model:t});e.$el.append(i.render())}})},outOfVotes:function(){var e=_.template($("#temp_error").html());this.$el.append(e({error_message:"You are out of Votes!",error_description:"You are dumb"})),$("body").find("#clearLS").on("click",function(){localStorage.setItem("userVotes",3)})}}),CurrentTrackView=Backbone.View.extend({tagName:"li",template:_.template($("#temp_current_track").html()),events:{},initialize:function(){this.render()},render:function(){return this.$el.html(this.template(this.model.toJSON()));console.log("elel")}}),TrackView=Backbone.View.extend({tagName:"li",attributes:function(){return{"data-track-id":this.model.get("track_id")}},template:_.template($("#temp_track").html()),events:{},initialize:function(){},render:function(){return this.draggaBilly(),this.$el.html(this.template(this.model.toJSON()))},voteNotifier:function(e){},draggaBilly:function(e){var t=this.el;console.log(t);var a=new Draggabilly(t,{axis:"y"});a.on("touchend",function(){a.disable()})},voteNote:function(e){console.log(e);var t=_.template($("#temp_vote_note").html()),a=$(e.currentTarget);this.$el.append(t(a.hasClass("upVote")?{votes_remaining:Number(localStorage.getItem("userVotes")-1),direction:"up"}:{votes_remaining:Number(localStorage.getItem("userVotes")-1),direction:"down"}))},upVoteMe:function(e){e.preventDefault();var t=this,a=t.model.collection.indexOf(t.model),i=t.model.collection.at(a-1),r=localStorage.getItem("userVotes"),n=Number(r-1);console.log(t.$el),t.$el.find(".voteNote").fadeOut("fast"),i&&(localStorage.setItem("userVotes",n),t.$el.addClass("flipFlopBottom"),t.$el.prev("li").addClass("flipFlopTop").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){t.$el.removeClass("flipFlopBottom"),t.$el.prev("li").removeClass("flipFlopTop");var a=t.model.get("position"),r=i.get("position"),n;n=a,t.model.set({position:r}),i.set({position:n})}))},downVoteMe:function(e){var t=this,a=this.model.collection.indexOf(this.model),i=this.model.collection.at(a+1),r=localStorage.getItem("userVotes"),n=Number(r-1);t.$el.find(".voteNote").remove(),i&&(localStorage.setItem("userVotes",n),t.$el.addClass("flipFlopTop"),t.$el.next("li").addClass("flipFlopBottom").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){var a=t.model.get("position"),r=i.get("position"),n;n=a,t.model.set({position:r}),i.set({position:n})}))}});$(document).ready(function(){var e=new AppView});